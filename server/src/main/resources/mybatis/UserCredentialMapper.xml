<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dsc.jk.mapper.UserCredentialMapper">

    <!-- Base Result Map -->
    <resultMap id="baseResultMap" type="cn.dsc.jk.entity.UserCredentialEntity">
        <id column="user_id" property="userId" jdbcType="BIGINT"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="remember_me_service" property="rememberMeService" jdbcType="VARCHAR"/>
        <result column="remember_me_token" property="rememberMeToken" jdbcType="VARCHAR"/>
        <result column="remember_me_last_used_time" property="rememberMeLastUsedTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- Base Column List -->
    <sql id="Base_Column_List">
        user_id,
        password,
        remember_me_service,
        remember_me_token,
        remember_me_last_used_time
    </sql>

    <select id="selectBySeries" resultType="org.springframework.security.web.authentication.rememberme.PersistentRememberMeToken">
        select u.email as username, c.remember_me_service as series, c.remember_me_token as tokenValue, c.remember_me_last_used_time as date 
        from user_credential c
            inner join user u on c.user_id = u.user_id
        where c.remember_me_service = #{seriesId}
    </select>

    <update id="clearRememberMeByAccount">
        update user_credential c inner join user u on c.user_id = u.user_id
        set c.remember_me_service = null, c.remember_me_token = null, c.remember_me_last_used_time = null
        where u.account = #{account}
    </update>

    <update id="updateRememberMeBySeries">
        update user_credential c
        set c.remember_me_token = #{tokenValue}, c.remember_me_last_used_time = #{lastUsed}
        where c.remember_me_service = #{series}
    </update>
</mapper>
